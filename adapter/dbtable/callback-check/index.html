<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="zend-authentication">  
    <link rel="canonical" href="https://docs.zendframework.com/adapter/dbtable/callback-check/">
    <link rel="shortcut icon" href="../../../img/favicon.ico">

    <title>CallbackCheck - zend-authentication - Zend Framework Docs</title>

    <link rel="stylesheet" href="/css/styles.css">
</head>
<body id="page-top">

    
    <div class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">

            
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            
            <span class="navbar-brand">
                <a class="logo-link" href="https://framework.zend.com/" data-tooltip data-placement="bottom" title="Go to the ZF homepage">
                    <img src="../../../img/zend-framework-logo.svg" height="28" alt="Zend Framework">
                </a>
            </span>
        </div>

        <div class="navbar-collapse collapse">

            
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="https://framework.zend.com/about">About</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/downloads">Install</a>
                </li>
                <li class="active">
                    <a href="https://docs.zendframework.com">Documentation</a>
                </li>
                <li>
                    <a href="https://www.zend.com/en/services/training">Training</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/blog">Blog</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/participate">Participate</a>
                </li>
            </ul>

            
            
                <div class="nav navbar-nav navbar-collapse visible-xs-block ">
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="../../..">zend-authentication</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../../.." class="subnavigation__link">zend-authentication</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../../../intro/" class="subnavigation__link">Intro</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item">
                                <span class="subnavigation__headline">Adapters</span>
                                <ul class="subnavigation__list">
                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../../intro/" class="subnavigation__link">Intro</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">DbTable</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../intro/" class="subnavigation__link">Intro</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../credential-treatment/" class="subnavigation__link">CredentialTreatmentAdapter</a>
    </li>

            
                
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">CallbackCheck</a>
    </li>

            
        </ul>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../../digest/" class="subnavigation__link">Digest</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../../http/" class="subnavigation__link">HTTP</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../../ldap/" class="subnavigation__link">LDAP</a>
    </li>

                                    
                                </ul>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../../../storage/" class="subnavigation__link">Identity Persistence</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../../../validator/" class="subnavigation__link">Validation</a>
                            </li>
                        
                    
                
            
        </ul>
    </div>

                </div>
            

            
            <div class="nav navbar-nav navbar-collapse visible-xs-block">
                <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentationâ€¦</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
            </div>
        </div>
    </div>
</div>

    
    <header class="header">
    <div class="container">
        <div class="row">

            
            <div class="col-xs-8">
                <h1 class="header__title">
                    Documentation

                    
                        <small class="header__subtitle">zend-authentication</small>
                    
                </h1>
            </div>

            
            <div class="col-xs-4 text-right">
                
                    

                    <a href="#" class="header__link header__link--search" data-toggle="modal" data-target="#mkdocs_search_modal" title="Open search">
                        <i class="fa fa-search"></i> Search
                    </a>
                    <a href="https://github.com/zendframework/zend-authentication/" class="header__link header__link--github" title="Go to repository of zend-authentication">
                        <i class="fa fa-github"></i> GitHub
                    </a>
                
            </div>
        </div>
    </div>
</header>

    
    <div class="laminas-announcement">
    <div class="container">
        <div class="row">
            <div class="col-xs-12"><strong>
                This package has moved. Visit its replacement, <a href="https://docs.laminas.dev/laminas-authentication/">laminas/laminas-authentication.</a>
            </strong></div>
        </div>
    </div>
</div>

    
    <div class="container">
        <div class="row">
            <div class="col-md-9 col-xs-12 content" role="main">
            <!-- content:begin -->
                
                    <ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
    <li><a href="https://framework.zend.com/">Home</a></li>

    
        <li><a href="https://docs.zendframework.com/">Documentation</a></li>

        
            <li><a href="../../..">zend-authentication</a></li>

            
                
                    
                    
                        <li>Adapters</li>
                    
                
            
                
                    
                    
                        <li>DbTable</li>
                    
                
            

            <li class="active">CallbackCheck</li>
        
    
</ol>






    
    
        <h2 class="chapter__headline">DbTable</h2>
    

    <div>
        
    

    
    
        <div class="toc">
            <h6 class="toc__headline">In This Article</h6>
            <ul class="toc__list">
                
                    <li class="toc__entry">
                        <a href="#configuration-options" class="toc__link">Configuration options</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#basic-usage" class="toc__link">Basic Usage</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#advanced-usage" class="toc__link">Advanced Usage</a>
                    </li>
                
            </ul>
        </div>
    

    </div>

    <h1 id="callback-verification">Callback Verification</h1>
<p>Some verification operations cannot be performed well on RDBMS servers. Other
times, you may be unsure which RDBMS system you will be using long-term, and
need to ensure authentication will work consistently. For these situations, you
can use the <code>Zend\Authentication\Adapter\DbTable\CallbackCheckAdapter</code> adapter.
Similar to the <a href="../credential-treatment/">CredentialTreatmentAdapter</a>, it
accepts a table name, identity column, and credential column; however, instead
of a credential treatment, it accepts a <em>credential validation callback</em> that
is executed when the database returns any matches, and which can be used to
perform additional credential verifications.</p>
<h2 id="configuration-options">Configuration options</h2>
<p>The available configuration options include:</p>
<ul>
<li><code>tableName</code>: This is the name of the database table that contains the
  authentication credentials, and against which the database authentication
  query is performed.</li>
<li><code>identityColumn</code>: This is the name of the database table column used to
  represent the identity.  The identity column must contain unique values, such
  as a username or e-mail address.</li>
<li><code>credentialColumn</code>: This is the name of the database table column used to
  represent the credential. Under a simple identity and password authentication
  scheme, the credential value corresponds to the password.</li>
<li><code>credentialValidationCallback</code>: A PHP callable to execute when the database returns matches. The callback will receive:</li>
<li>the value of the <code>credentialColumn</code> returned from the database</li>
<li>the credential that was used by the adapter during authentication</li>
</ul>
<h2 id="basic-usage">Basic Usage</h2>
<p>Many databases do not provide functions that implement a cryptographically
secure hashing mechanism. Additionally, you may want to ensure that should you
switch database systems, hashing is consistent. This is a perfect use case for
the <code>CallbackCheckAdapter</code> adapter; you can implement the password hashing and
verification within PHP instead.</p>
<p>The following code creates an adapter for an in-memory database, creates a
simple table schema, and inserts a row against which we can perform an
authentication query later. This example requires the PDO SQLite extension to
be available:</p>
<pre><code class="language-php">use Zend\Db\Adapter\Adapter as DbAdapter;

// Create a SQLite database connection
$dbAdapter = new DbAdapter([
    'driver'   =&gt; 'Pdo_Sqlite',
    'database' =&gt; 'data/sqlite.db',
]);

// Build a simple table creation query
$sqlCreate = 'CREATE TABLE [users] ('
    . '[id] INTEGER  NOT NULL PRIMARY KEY, '
    . '[username] VARCHAR(50) UNIQUE NOT NULL, '
    . '[password] VARCHAR(255) NULL, '
    . '[real_name] VARCHAR(150) NULL)';

// Create the authentication credentials table
$dbAdapter-&gt;query($sqlCreate);

// Build a query to insert a row for which authentication may succeed
$sqlInsert = &quot;INSERT INTO users (username, password, real_name) &quot;
    . &quot;VALUES ('my_username', 'my_password', 'My Real Name')&quot;;

// Insert the data
$dbAdapter-&gt;query($sqlInsert);
</code></pre>

<p>As you add users, you will need to create a hash of the password provided and
insert that into the database. For users on PHP 5.5+, you can use
<a href="http://php.net/password_hash">password_hash()</a>:</p>
<pre><code class="language-php">$hash = password_hash($password, PASSWORD_DEFAULT);
</code></pre>

<blockquote>
<h3>Password hash length</h3>
<p>As of the time of writing, PHP uses a bcrypt algorithm by default for hashing
passwords with <code>password_hash()</code>, and this produces 60 character strings. However,
the default may change over time, and php.net recommends using 255 character
fields for storage to allow for larger hash sizes in the future.</p>
</blockquote>
<p>To verify a password, we'll create a callback that uses
<a href="http://php.net/manual/en/function.password-verify.php">password_verify()</a>:</p>
<pre><code class="language-php">$passwordValidation = function ($hash, $password) {
    return password_verify($password, $hash);
};
</code></pre>

<p>Now that we have the database connection and a password validation function,
we can create our <code>Zend\Authentication\Adapter\DbTable\CallbackCheckAdapter</code> adapter
instance, passing the options to the constructor or later via setter methods:</p>
<pre><code class="language-php">use Zend\Authentication\Adapter\DbTable\CallbackCheckAdapter as AuthAdapter;

// Configure the instance with constructor parameters:
$authAdapter = new AuthAdapter(
    $dbAdapter,
    'users',
    'username',
    'password',
    $passwordValidation
);

// Or configure the instance with setter methods:
$authAdapter = new AuthAdapter($dbAdapter);

$authAdapter
    -&gt;setTableName('users')
    -&gt;setIdentityColumn('username')
    -&gt;setCredentialColumn('password')
    -&gt;setCredentialValidationCallback($passwordValidation);
</code></pre>

<p>At this point, the authentication adapter instance is ready to accept
authentication queries. In order to formulate an authentication query, the
input credential values are passed to the adapter prior to calling the
<code>authenticate()</code> method:</p>
<pre><code class="language-php">// Set the input credential values (e.g., from a login form):
$authAdapter
    -&gt;setIdentity('my_username')
    -&gt;setCredential('my_password');

// Perform the authentication query, saving the result
$result = $authAdapter-&gt;authenticate();
</code></pre>

<p>In addition to the availability of the <code>getIdentity()</code> method upon the
authentication result object, <code>Zend\Authentication\Adapter\DbTable\CallbackCheckAdapter</code>
also supports retrieving the table row upon authentication success:</p>
<pre><code class="language-php">// Print the identity:
echo $result-&gt;getIdentity() . &quot;\n\n&quot;;

// Print the result row:
print_r($authAdapter-&gt;getResultRowObject());

/* Output:
my_username

Array
(
    [id] =&gt; 1
    [username] =&gt; my_username
    [password] =&gt; my_password
    [real_name] =&gt; My Real Name
)
*/
</code></pre>

<p>Since the table row contains the credential value, it is important to secure
the values against unintended access.</p>
<p>When retrieving the result object, we can either specify what columns to
return, or what columns to omit:</p>
<pre><code class="language-php">// Specify the columns to return:
$columnsToReturn = [
    'id',
    'username',
    'real_name',
];
print_r($authAdapter-&gt;getResultRowObject($columnsToReturn));

/* Output:

Array
(
   [id] =&gt; 1
   [username] =&gt; my_username
   [real_name] =&gt; My Real Name
)
*/

// Or specify the columns to omit; when using this approach,
// pass a null value as the first argument to getResultRowObject():
$columnsToOmit = ['password'];
print_r($authAdapter-&gt;getResultRowObject(null, $columnsToOmit);

/* Output:

Array
(
   [id] =&gt; 1
   [username] =&gt; my_username
   [real_name] =&gt; My Real Name
)
*/
</code></pre>

<h2 id="advanced-usage">Advanced Usage</h2>
<p>While the basic use case will fit most scenarios, there may be cases where you have
specialized needs, such as additional criteria that needs to be met for a user to
match.</p>
<h3>Adding criteria to match</h3>
<p>Since the validation callback is only provided the hash value from the database
and the credential provided by the user, you cannot do more complex matching
within it. However, you can add criteria to the SQL sent to the server by
retrieving the <code>Zend\Db\Sql\Select</code> instance is uses.</p>
<p>As an example, many websites require a user to activate their account before
allowing them to login for the first time. We can add that criteria as follows:</p>
<pre><code class="language-php">// Create a basic adapter
$adapter = new AuthAdapter(
    $db,
    'users',
    'username',
    'password',
    $passwordValidation
);

// Now retrieve the Select instance and modify it:
$select = $adapter-&gt;getDbSelect();
$select-&gt;where('active = &quot;TRUE&quot;');

// Authenticate; this will include &quot;users.active = TRUE&quot; in the WHERE clause:
$adapter-&gt;authenticate();
</code></pre>




    <nav>
    <ul class="page-nav hidden-print">

        
        <li class="page-nav__item">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="../credential-treatment/">
                    <i class="fa fa-chevron-left"></i> Previous
                </a>
            
        </li>

        
        <li class="page-nav__item">
            
                <a rel="next" class="page-nav__link page-nav__link--next" href="../../digest/">
                    Next <i class="fa fa-chevron-right"></i>
                </a>
            
        </li>
    </ul>
</nav>




    <div class="help-wanted">
        <p>
            Found a mistake or want to contribute to the documentation?
            <a href="https://github.com/zendframework/zend-authentication/edit/master/docs/book/adapter/dbtable/callback-check.md" target="_blank" class="help-wanted__link">
                Edit this page on GitHub!
            </a>
        </p>
    </div>

                
            <!-- content:end -->
            </div>
            <div class="col-md-3 col-xs-12 sidebar">
                
                    <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentationâ€¦</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="../../..">zend-authentication</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../../.." class="subnavigation__link">zend-authentication</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../../../intro/" class="subnavigation__link">Intro</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item">
                                <span class="subnavigation__headline">Adapters</span>
                                <ul class="subnavigation__list">
                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../../intro/" class="subnavigation__link">Intro</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">DbTable</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../intro/" class="subnavigation__link">Intro</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../credential-treatment/" class="subnavigation__link">CredentialTreatmentAdapter</a>
    </li>

            
                
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">CallbackCheck</a>
    </li>

            
        </ul>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../../digest/" class="subnavigation__link">Digest</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../../http/" class="subnavigation__link">HTTP</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../../ldap/" class="subnavigation__link">LDAP</a>
    </li>

                                    
                                </ul>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../../../storage/" class="subnavigation__link">Identity Persistence</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../../../validator/" class="subnavigation__link">Validation</a>
                            </li>
                        
                    
                
            
        </ul>
    </div>

                
            </div>
        </div>
    </div>

    
    <footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-9">
                <h5>Zend Framework</h5>
                <ul>
                    <li><a href="https://framework.zend.com/">framework.zend.com</a></li>
                    <li><a href="https://docs.zendframework.com">docs.zendframework.com</a></li>
                    <li><a href="https://packages.zendframework.com">packages.zendframework.com</a></li>
                    <li><a href="https://apigility.org">apigility.org</a></li>
                    <li><a href="https://getexpressive.org/">getexpressive.org</a></li>
                </ul>
            </div>
        </div>

        
        <div class="row">
            <div class="col-md-12 text-center">
                <a class="footer__button" href="#page-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="row">

            
            <div class="col-md-9">
                <h4 class="footer__headline">Copyright</h4>
                <p>&copy; 2006-2020 by <a href="https://www.zend.com/">Zend</a> by <a href="https://www.perforce.com/">Perforce</a>.</p>
            </div>

            
            <div class="col-md-3">
                <h4 class="footer__headline">Support</h4>
                <ul class="support__list">
                    <li class="support__list-item">
                        <a href="https://discourse.laminas.dev" class="support__link" title="Forum"><i class="fa fa-comments"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://laminas.dev/chat/" class="support__link" title="Chat"><i class="fa fa-slack"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://github.com/zendframework" class="support__link" title="Github"><i class="fa fa-github"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://twitter.com/zfdevteam" class="support__link" title="Twitter"><i class="fa fa-twitter"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>

<nav class="cookie-bar navbar navbar-fixed-bottom navbar-default hidden">
    <div class="container">
        <p class="navbar-text">
            We use cookies to allow you to dismiss dialogs such as the Laminas
            Project notification.
        </p>
        <button type="button" class="cookie-button btn btn-default navbar-btn">Allow Cookies</button>
    </div>
</nav>

    <script>
        var base_url = '../../..',
            siteName = 'zend-authentication';
    </script>
    <script src="/js/scripts.js"></script>
    <script src="../../../search/main.js"></script>

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>



</body>


</html>
